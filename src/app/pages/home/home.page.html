<!--
  This file is part of the Music Education Interface project.
  Copyright (C) 2025 Alberto Acquilino

  Licensed under the GNU Affero General Public License v3.0.
  See the LICENSE file for more details.
-->

<ion-menu contentId="main-content" menuId="settingsMenu">
  <ion-header>
    <ion-toolbar>
      <ion-title>Settings</ion-title>
    </ion-toolbar>
  </ion-header>
  <ion-content class="ion-padding">
    <div class="container">
      <div class="sidebar">
        <div class="options-panel">
          <h2 class="panel-title">Options</h2>
        
          <!-- Instrument Selection -->
          <ion-item [disabled]="isPlaying()" class="instrument-select-item">
            <div class="select-container">
              <ion-label class="fixed-label">Select Instrument</ion-label>
              <div class="gradient-select-wrapper">
                <ion-select (ionChange)="selectInstrument($event)" mode="ios" [value]="selectedInstrument" interface="popover" class="instrument-select">
                  <ion-select-option value="trumpet">Trumpet</ion-select-option>
                  <ion-select-option value="clarinet">Clarinet</ion-select-option>
                </ion-select>
                <div class="selected-text">{{selectedInstrument | titlecase}}</div>
              </div>
            </div>
          </ion-item>
          
          <!-- Display options based on selected instrument -->
          <ng-container *ngIf="selectedInstrument">
            <ion-item [disabled]="isPlaying()" class="option-item">
              <ion-label>Mode</ion-label>
              <div class="option-control-wrapper">
                <div class="custom-mode-selector" 
                    [ngClass]="{
                      'trumpet-active': mode === 'trumpet',
                      'clarinet-active': mode === 'clarinet',
                      'tuner-active': mode === 'tuner'
                    }">
                  <div class="mode-option" 
                      [ngClass]="{'active': mode === 'trumpet'}" 
                      (click)="switchToMode('trumpet')"
                      *ngIf="selectedInstrument === 'trumpet'">
                    TRUMPET
                  </div>
                  <div class="mode-option" 
                      [ngClass]="{'active': mode === 'clarinet'}" 
                      (click)="switchToMode('clarinet')"
                      *ngIf="selectedInstrument === 'clarinet'">
                    CLARINET
                  </div>
                  <div class="mode-option" 
                      [ngClass]="{'active': mode === 'tuner'}" 
                      (click)="switchToMode('tuner')">
                    TUNER
                  </div>
                </div>
              </div>
            </ion-item>

            <ion-item button (click)="openPicker('frequency')" [disabled]="isPlaying()" class="option-item">
              <ion-label>A4</ion-label>
              <div class="value-display">{{ refFrequencyValue$ }} Hz</div>
            </ion-item>

            <ion-item class="option-item">
              <ion-label>Flats & Sharps</ion-label>
              <ion-toggle [checked]="useFlatsAndSharps" (ionChange)="switchUseFlatsAndSharps($event)" [disabled]="isPlaying()">
                <b>&flat; &amp; &sharp;</b>
              </ion-toggle>
            </ion-item>

            <ion-item class="option-item">
              <ion-label>Dynamics</ion-label>
              <ion-toggle [checked]="useDynamics" (ionChange)="switchUseDynamics($event)" [disabled]="isPlaying()">
                Dynamics
              </ion-toggle>
            </ion-item>
          </ng-container>
        </div>
      </div>
    </div>
  </ion-content>
</ion-menu>


<div class="ion-page" id="main-content">
  <ion-content [fullscreen]="true">
    <div id="container">
      <div class="wrapper" id="wrapper">
        <div class="top-middle-container">
          <div class="top" [ngClass]="!isPlaying()?'landscape-d-none':''">
            <div class="metronome">
              <div class="metronome-bullet">
                <h1 id="metronome-label" *ngIf="beat$|async as beat">
                  {{ beat.beat >= 0 ? (beat.beat + 1): '&nbsp;'}}
                </h1>
                <semaphore-light [currentAction]="currentAction"></semaphore-light>
              </div>
            </div>
            <ng-container *ngIf="mode === 'tuner'">
              <div class="chromatic-tuner">
                <chromatic-tuner [refFrequencyValue$]="refFrequencyValue$"></chromatic-tuner>
              </div>
            </ng-container>
            <ng-container *ngIf="selectedInstrument === 'trumpet' && mode === 'trumpet'">
              <div class="trumpet">
                <trumpet-diagram [trumpetButtons]="trumpetBtns"></trumpet-diagram>
              </div>
            </ng-container>
            <ng-container *ngIf="selectedInstrument === 'clarinet' && mode === 'clarinet'">
              <div class="clarinet">
               
                <img [src]="clarinetPosition" alt="Clarinet Position" />
              </div>
            </ng-container>

          </div>
          <!--MIDDLE-->
          <div class="middle" *ngIf="isPlaying()">
            <div class="score">
              <score-view id="score-image" [score]="score"></score-view>
            </div>
          </div>
        </div>

        <div class="bottom" *ngIf="!isPlaying()">
          <div class="controls controls-margin">
            <!--TEMPO-->
            <div class="tempo-wrapper">
                <tempo-selector *ngIf="tempo$ | async as tempo" 
                  [tempo]="tempo" 
                  (change)="changeTempo($event)"
                ></tempo-selector>              
            </div>

            <div class="low-note-wrapper">
              <note-selector 
                label="Low Note:"
                [note]="lowNote" 
                [selectedInstrument]="selectedInstrument"
                [useFlatsAndSharps]="useFlatsAndSharps"
                (change)="changeLowNote($event)"
              ></note-selector>
            </div>

            <div class="high-note-wrapper">
              <note-selector 
                label="High Note:"
                [note]="highNote"
                [selectedInstrument]="selectedInstrument"
                [useFlatsAndSharps]="useFlatsAndSharps"
                (change)="changeHighNote($event)"
              ></note-selector>
            </div>

          </div>
        </div>
      </div>

    </div>
  </ion-content>

  <ion-footer>
    <ion-button (click)="startStop()" expand="block">
      {{isPlaying() ? 'Stop':'Start'}}
    </ion-button>
  </ion-footer>

</div>
